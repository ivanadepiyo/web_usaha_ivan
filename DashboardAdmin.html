<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Admin</title>
<style>
body{margin:0;font-family:Segoe UI;background:#f0f2f5}
header{background:#1e3c72;color:white;padding:20px;text-align:center}
.container{max-width:1000px;margin:30px auto;background:white;padding:20px;border-radius:12px}
table{width:100%;border-collapse:collapse}
th,td{padding:12px;border-bottom:1px solid #ddd}
th{background:#1e3c72;color:white}
.role-admin{color:green;font-weight:bold}
</style>
</head>

<body>
<header>Dashboard Admin</header>

<div class="container">
<table>
<thead><tr><th>No</th><th>UID</th><th>Email</th><th>Role</th></tr></thead>
<tbody id="userTable"></tbody>
</table>
<button id="logoutBtn">Logout</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBjDHapatmMS4C2EDFXxp_WQXVhb0UCZZg",
  authDomain: "web-usaha-ivan.firebaseapp.com",
  projectId: "web-usaha-ivan"
});

const auth = firebase.auth();
const db = firebase.firestore();
const table = document.getElementById("userTable");

auth.onAuthStateChanged(async user=>{
  if(!user) return location.href="admin-login.html";

  const admin = await db.collection("admins").doc(user.uid).get();
  if(!admin.exists){
    await auth.signOut();
    return location.href="admin-login.html";
  }

  const snap = await db.collection("users").get();
  let no=1;
  snap.forEach(d=>{
    table.innerHTML += `<tr>
      <td>${no++}</td>
      <td>${d.id}</td>
      <td>${d.data().email||"-"}</td>
      <td class="role-admin">user</td>
    </tr>`;
  });
});

logoutBtn.onclick = async ()=>{
  await auth.signOut();
  location.href="admin-login.html";
};
</script>
</body>
</html>
