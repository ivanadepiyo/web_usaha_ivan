<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
</head>

<body>
  <h2>Dashboard Admin</h2>

  <nav>
    <a href="tambah.html">Tambah</a> |
    <a href="lihat.html">Lihat</a> |
    <button id="logoutBtn">Logout</button>
  </nav>

  <table border="1" id="dataTable">
    <tr>
      <th>Nama</th>
      <th>Bidang</th>
      <th>Aksi</th>
    </tr>
  </table>

  <script type="module">
    import { auth, db } from "./firebase.js";
    import { onAuthStateChanged, signOut }
      from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { collection, getDocs, deleteDoc, doc }
      from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    onAuthStateChanged(auth, user => {
      if (!user) location.href = "login.html";
      else loadData();
    });

    logoutBtn.onclick = () => signOut(auth).then(()=>location.href="login.html");

    async function loadData(){
      const q = await getDocs(collection(db,"usaha"));
      q.forEach(d=>{
        const r=dataTable.insertRow();
        r.insertCell(0).innerText=d.data().nama;
        r.insertCell(1).innerText=d.data().bidang;
        r.insertCell(2).innerHTML=
          `<button onclick="edit('${d.id}')">Edit</button>
           <button onclick="hapus('${d.id}')">Hapus</button>`;
      });
    }

    window.edit=id=>location.href=`edit.html?id=${id}`;
    window.hapus=async id=>{
      if(confirm("Hapus?")){
        await deleteDoc(doc(db,"usaha",id));
        location.reload();
      }
    }
  </script>
</body>
</html>
