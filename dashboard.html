<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard | Web Perusahaan</title>

<style>
*{box-sizing:border-box;font-family:"Segoe UI",Arial}
:root{
  --bg:#f0f2f5;
  --card:#ffffff;
  --text:#222;
  --primary:#1e3c72;
}
body.dark{
  --bg:#121212;
  --card:#1e1e1e;
  --text:#f5f5f5;
}
body{
  margin:0;background:var(--bg);color:var(--text);
  min-height:100vh;transition:.3s
}
header{
  background:var(--primary);color:white;
  padding:20px;text-align:center;font-size:24px
}
.container{
  max-width:600px;margin:30px auto;
  background:var(--card);border-radius:12px;
  padding:20px;box-shadow:0 10px 25px rgba(0,0,0,.15);
  text-align:center
}
.badge{
  display:inline-block;
  padding:5px 12px;
  border-radius:20px;
  background:#4caf50;
  color:white;font-size:12px;
  margin-bottom:10px
}
button{
  display:block;width:80%;
  margin:12px auto;padding:12px 20px;
  border:none;border-radius:8px;
  background:var(--primary);color:white;
  font-weight:bold;cursor:pointer;font-size:16px
}
button:hover{opacity:.9}
#logoutBtn{background:#d9534f}
.toggle{cursor:pointer;font-size:20px;margin-bottom:10px}

/* MODAL */
.modal{
  display:none;position:fixed;
  inset:0;background:rgba(0,0,0,.6);
  justify-content:center;align-items:center
}
.modal-content{
  background:white;padding:20px;
  border-radius:12px;text-align:center;
  width:300px
}
body.dark .modal-content{background:#1e1e1e;color:white}
.modal-content input{
  width:90%;padding:10px;
  margin-top:10px;border-radius:6px;
  border:1px solid #ccc;font-size:16px
}
</style>
</head>

<body>

<header>Dashboard Web Perusahaan</header>

<div class="container">
  <div class="toggle" onclick="toggleDark()">ğŸŒ™</div>
  <div class="badge" id="roleBadge">Loading...</div>
  <p id="lastLogin" style="font-size:12px;opacity:.7"></p>

  <h2>Menu Akses</h2>

  <button id="btnDataDiri">Data Diri</button>
  <button id="btnPerusahaan">Perusahaan ğŸ”</button>
  <button id="btnGaji">Daftar Gaji ğŸ”</button>
  <button id="btnPekerjaan">Pekerjaan ğŸ”</button>
  <button id="btnKalkulator">Kalkulator</button>
  <button id="btnBukuCatatan">Buku Catatan</button>

  <button id="logoutBtn">Logout</button>
</div>

<!-- MODAL KODE -->
<div id="modalKode" class="modal">
  <div class="modal-content">
    <h3>ğŸ” Kode Akses</h3>
    <input type="password" id="inputKode" placeholder="Masukkan kode">
    <button id="submitKode">Buka</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyBjDHapatmMS4C2EDFXxp_WQXVhb0UCZZg",
  authDomain:"web-usaha-ivan.firebaseapp.com",
  projectId:"web-usaha-ivan"
});

const auth=firebase.auth();
const db=firebase.firestore();

const modal=document.getElementById("modalKode");
const inputKode=document.getElementById("inputKode");
let targetPage="";

/* ===== AUTH CHECK ===== */
auth.onAuthStateChanged(async user=>{
  if(!user) return location.href="login.html";

  // ambil data user
  const snap=await db.collection("users").doc(user.uid).get();
  const d=snap.data()||{};
  roleBadge.textContent = d.role==="admin" ? "ADMIN" : "USER";
  roleBadge.style.background = d.role==="admin" ? "#4caf50" : "#777";

  lastLogin.textContent = "Login terakhir: " + new Date().toLocaleString();

  // simpan activity
  db.collection("activity_logs").add({
    uid:user.uid,
    action:"login_dashboard",
    time:firebase.firestore.FieldValue.serverTimestamp()
  });
});

/* ===== DARK MODE ===== */
function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("dark",document.body.classList.contains("dark"));
}
if(localStorage.getItem("dark")==="true") document.body.classList.add("dark");

/* ===== LOGOUT ===== */
logoutBtn.onclick=()=>{
  auth.signOut().then(()=>location.href="login.html");
};

/* ===== PAGE DIRECT ===== */
btnDataDiri.onclick=()=>location.href="DataDiri.html";
btnKalkulator.onclick=()=>location.href="kalkulator.html";
btnBukuCatatan.onclick=()=>location.href="BukuCatatan.html";

/* ===== MODAL ===== */
function bukaModal(page){
  targetPage=page;
  modal.style.display="flex";
  inputKode.value="";
  inputKode.focus();
}
btnPerusahaan.onclick=()=>bukaModal("Perusahaan.html");
btnGaji.onclick=()=>bukaModal("Gaji.html");
btnPekerjaan.onclick=()=>bukaModal("Pekerjaan.html");

/* ===== SUBMIT KODE ===== */
submitKode.onclick=cekKode;
inputKode.addEventListener("keyup",e=>{
  if(e.key==="Enter") cekKode();
});

function cekKode(){
  if(inputKode.value==="1234"){
    modal.style.display="none";
    location.href=targetPage;
  }else{
    alert("âŒ Kode salah");
  }
}

/* ===== CLOSE MODAL ===== */
window.onclick=e=>{
  if(e.target===modal) modal.style.display="none";
};
</script>

</body>
</html>
