<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Daftar Akun | Web Perusahaan</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* RESET DASAR */
    .page-login * {
      box-sizing: border-box;
      font-family: "Segoe UI", Arial, sans-serif;
    }

    body.page-login {
      margin: 0;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #333;
    }

    .page-login .card {
      background: #ffffff;
      width: 100%;
      max-width: 400px;
      padding: 30px;
      border-radius: 14px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      text-align: center;
    }

    .page-login .card h2 {
      margin-bottom: 20px;
      color: #1e3c72;
    }

    .input-group {
      position: relative;
      margin-bottom: 14px;
    }

    .page-login input {
      width: 100%;
      padding: 12px 14px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 15px;
    }

    .page-login input:focus {
      outline: none;
      border-color: #2a5298;
      box-shadow: 0 0 0 2px rgba(42,82,152,0.2);
    }

    .check {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
    }
    .green { background-color: green; }
    .red { background-color: red; }

    .page-login button {
      width: 100%;
      padding: 12px;
      background: #1e3c72;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }

    .page-login button:hover {
      background: #2a5298;
    }

    #msg {
      margin-top: 10px;
      font-size: 14px;
      color: red;
    }

    @media (max-width: 480px) {
      body.page-login .card {
        margin: 20px;
        padding: 24px;
      }
    }
  </style>
</head>
<body class="page-login auth">

  <div class="card">
    <h2>Daftar Akun</h2>

    <div class="input-group">
      <input id="nama" placeholder="Nama">
      <span id="namaCheck" class="check"></span>
    </div>
    <div class="input-group">
      <input id="email" placeholder="Email">
      <span id="emailCheck" class="check"></span>
    </div>
    <div class="input-group">
      <input id="telp" placeholder="Nomor Telepon">
      <span id="telpCheck" class="check"></span>
    </div>
    <div class="input-group">
      <input id="alamat" placeholder="Alamat">
      <span id="alamatCheck" class="check"></span>
    </div>
    <div class="input-group">
      <input id="password" type="password" placeholder="Password">
      <span id="passwordCheck" class="check"></span>
    </div>
    <div class="input-group">
      <input id="confirm" type="password" placeholder="Konfirmasi Password">
      <span id="confirmCheck" class="check"></span>
    </div>

    <button onclick="register()">Simpan</button>
    <p id="msg"></p>
  </div>

  <script src="firebase-init.js"></script>
  <script>
    const namaInput = document.getElementById("nama");
    const emailInput = document.getElementById("email");
    const telpInput = document.getElementById("telp");
    const alamatInput = document.getElementById("alamat");
    const passwordInput = document.getElementById("password");
    const confirmInput = document.getElementById("confirm");
    const msg = document.getElementById("msg");

    // Fungsi validasi real-time
    function setCheck(element, condition){
      element.className = condition ? "check green" : "check red";
    }

    namaInput.addEventListener("input", ()=>setCheck(document.getElementById("namaCheck"), namaInput.value.length > 0 && namaInput.value.length <= 15));
    emailInput.addEventListener("input", ()=>setCheck(document.getElementById("emailCheck"), /^[\w.+-]+@gmail\.com$/.test(emailInput.value)));
    telpInput.addEventListener("input", ()=>setCheck(document.getElementById("telpCheck"), telpInput.value.trim() !== ""));
    alamatInput.addEventListener("input", ()=>setCheck(document.getElementById("alamatCheck"), alamatInput.value.trim() !== ""));
    passwordInput.addEventListener("input", ()=>setCheck(document.getElementById("passwordCheck"), /^(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9!@#$%^&*]).{6,}$/.test(passwordInput.value)));
    confirmInput.addEventListener("input", ()=>setCheck(document.getElementById("confirmCheck"), confirmInput.value === passwordInput.value && confirmInput.value !== ""));

    // Fungsi register
    function register(){
      msg.textContent = "";
      msg.style.color = "red";

      // Pastikan semua check hijau
      if(document.querySelectorAll(".check.green").length !== 6){
        msg.textContent = "Periksa semua field, pastikan benar!";
        return;
      }

      const nama = namaInput.value;
      const email = emailInput.value;
      const telp = telpInput.value;
      const alamat = alamatInput.value;
      const password = passwordInput.value;

      // Firebase Auth
      firebase.auth().createUserWithEmailAndPassword(email, password)
        .then(userCredential => {
          const user = userCredential.user;
          // Simpan data tambahan
          firebase.firestore().collection("users").doc(user.uid).set({
            nama, email, telp, alamat,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          })
          .then(()=>{
            msg.style.color = "green";
            msg.textContent = "Akun berhasil dibuat! Silahkan login.";
            setTimeout(()=> window.location.href="login.html",2000);
          })
          .catch(err=>{ msg.textContent="Gagal menyimpan data: "+err.message });
        })
        .catch(err=>{
          msg.textContent="Gagal mendaftar: "+err.message;
        });
    }
  </script>
</body>
</html>
